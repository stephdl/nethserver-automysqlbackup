#!/bin/bash
MYSQLUSER=backupuser
MYSQLPASS=$(/sbin/e-smith/config getprop automysqlbackup DbPassword)
MARIADB102=$(/sbin/e-smith/config getprop rh-mariadb102-mariadb status)

if [[ $MARIADB102 -eq 'disabled' ]]; then
    exit 0
fi

#create backupuser and give rights
mysql102 -e "CREATE USER $MYSQLUSER@localhost IDENTIFIED BY '$MYSQLPASS'; GRANT EVENT,SELECT,LOCK TABLES ON *.* TO $MYSQLUSER@localhost; FLUSH PRIVILEGES;" 2> /dev/null

#protect the backup folder
chmod -R 700 /var/lib/nethserver/automysqlbackup-rh-mariadb102/

